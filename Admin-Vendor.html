<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Vendor Spots</title>
  <link rel="stylesheet" href="Css/vendorbooking.css" />
  <style>
    .admin-wrap{width:95%;max-width:1000px;margin:28px auto;font-family:Roboto,system-ui,Segoe UI,Arial}
    .admin-header{display:flex;align-items:center;gap:12px}
    .spots-table{width:100%;border-collapse:collapse;margin-top:16px}
    .spots-table th,.spots-table td{padding:8px;border:1px solid #eee}
    .form-row{display:flex;gap:8px;margin-top:12px}
    input,select{padding:8px;border-radius:6px;border:1px solid #ddd}
  </style>
</head>
<body>
  <div class="admin-wrap">
    <h1>Vendor Spots Admin</h1>
    <p>This admin edits the spots JSON used by the booking map. Changes are saved to localStorage (SPOTS_KEY).</p>
    <div class="auth">
      <label>Admin password: <input id="admin-pass" type="password" /></label>
      <button id="admin-login" class="btn">Login</button>
      <span id="auth-status"></span>
    </div>

    <div id="admin-area" style="display:none;">
      <div style="display:flex;gap:10px;align-items:center;margin-top:12px;">
        <button id="load-spots" class="btn">Load Spots</button>
        <button id="save-spots" class="btn primary">Save Spots</button>
        <button id="export-spots-admin" class="btn">Export JSON</button>
        <button id="clear-spots-admin" class="btn">Clear Spots</button>
        <button id="admin-logout" class="btn">Logout</button>
      </div>

      <table class="spots-table">
        <thead><tr><th>ID</th><th>Type</th><th>Coords</th><th>Price</th><th>Actions</th></tr></thead>
        <tbody id="spots-body"></tbody>
      </table>

      <h3>Add / Edit Spot</h3>
      <div class="form-row">
        <input id="s-id" placeholder="id (A1)" />
        <select id="s-type"><option value="rect">rect</option><option value="circle">circle</option></select>
        <input id="s-x" placeholder="x / cx" />
        <input id="s-y" placeholder="y / cy" />
        <input id="s-w" placeholder="w / r" />
        <input id="s-price" placeholder="price" />
        <button id="add-spot" class="btn primary">Add / Update</button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const ADMIN_PASS = 'letmein'; // change locally
    const SPOTS_KEY = 'vendor_spots_v1';
    const authStatus = document.getElementById('auth-status');
    const adminArea = document.getElementById('admin-area');
    document.getElementById('admin-login').addEventListener('click', ()=>{
      const p = document.getElementById('admin-pass').value;
      if(p === ADMIN_PASS){
        authStatus.textContent = 'Authenticated'; adminArea.style.display = 'block';
        // set a simple local flag so other pages can detect admin auth
        localStorage.setItem('admin_auth','1');
      } else { authStatus.textContent = 'Wrong password'; }
    });

    document.getElementById('admin-logout').addEventListener('click', ()=>{
      localStorage.removeItem('admin_auth'); authStatus.textContent = 'Logged out'; adminArea.style.display='none';
    });

    function load(){
      const raw = localStorage.getItem(SPOTS_KEY); if(!raw) return [];
      try{ return JSON.parse(raw); }catch(e){ return []; }
    }
    function save(data){ localStorage.setItem(SPOTS_KEY, JSON.stringify(data)); alert('Saved to localStorage'); }

    const spotsBody = document.getElementById('spots-body');
    function refresh(){
      const data = load(); spotsBody.innerHTML='';
      data.forEach((s,i)=>{
        const tr = document.createElement('tr');
        const coordText = s.type==='rect' ? `x:${s.x},y:${s.y},w:${s.w},h:${s.h}` : `cx:${s.cx},cy:${s.cy},r:${s.r}`;
        tr.innerHTML = `<td>${s.id}</td><td>${s.type}</td><td>${coordText}</td><td>$${s.price}</td><td><button data-i='${i}' class='edit-btn btn'>Edit</button> <button data-i='${i}' class='del-btn btn'>Delete</button></td>`;
        spotsBody.appendChild(tr);
      });
      Array.from(document.getElementsByClassName('edit-btn')).forEach(b=>b.addEventListener('click', e=>{
        const i = +e.target.dataset.i; const d = load()[i];
        document.getElementById('s-id').value = d.id; document.getElementById('s-type').value = d.type;
        if(d.type==='rect'){ document.getElementById('s-x').value=d.x; document.getElementById('s-y').value=d.y; document.getElementById('s-w').value=d.w; }
        else { document.getElementById('s-x').value=d.cx; document.getElementById('s-y').value=d.cy; document.getElementById('s-w').value=d.r; }
        document.getElementById('s-price').value = d.price;
      }));
      Array.from(document.getElementsByClassName('del-btn')).forEach(b=>b.addEventListener('click', e=>{
        if(!confirm('Delete this spot?')) return; const i = +e.target.dataset.i; const arr = load(); arr.splice(i,1); save(arr); refresh();
      }));
    }

    document.getElementById('load-spots').addEventListener('click', ()=> refresh());
    document.getElementById('save-spots').addEventListener('click', ()=>{
      const arr = load(); save(arr); // trivial save (no editor modifications here)
    });

    document.getElementById('add-spot').addEventListener('click', ()=>{
      const id = document.getElementById('s-id').value.trim(); if(!id) return alert('id required');
      const type = document.getElementById('s-type').value; const x = Number(document.getElementById('s-x').value||0); const y = Number(document.getElementById('s-y').value||0); const w = Number(document.getElementById('s-w').value||0); const price = Number(document.getElementById('s-price').value||0);
      const arr = load(); const existing = arr.findIndex(s=>s.id===id);
      const spot = type==='rect' ? { id, type, x, y, w, h:w, price } : { id, type, cx:x, cy:y, r:w, price };
      if(existing>=0) arr[existing] = spot; else arr.push(spot);
      save(arr); refresh();
    });

    document.getElementById('export-spots-admin').addEventListener('click', ()=>{
      const data = load(); const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='spots.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    document.getElementById('clear-spots-admin').addEventListener('click', ()=>{ if(!confirm('Clear spots?')) return; localStorage.removeItem(SPOTS_KEY); refresh(); });

    // refresh on load
    refresh();
  })();
  </script>
</body>
</html>
